---
import SidebarLink from './SidebarLink.astro';
import { getNavigation } from '../data/navigation';
import { SITE_TITLE } from '../consts';

const navigation = await getNavigation();
---
<div
  x-data="{ open: false }"
  x-init="open = JSON.parse(localStorage.getItem('sidebar-open')) ?? (window.innerWidth >= 768)"
  x-effect="localStorage.setItem('sidebar-open', JSON.stringify(open))"
>
  <button
    class="md:hidden p-4 text-neutral-700"
    @click="open = !open"
    :aria-expanded="open.toString()"
    :aria-label="open ? 'Fermer le menu de navigation' : 'Ouvrir le menu de navigation'"
  >
    <svg x-show="!open" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
    <svg x-show="open" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
  </button>
  <aside
    x-show="open"
    @click.outside="open = false"
    id="sidebar"
    role="navigation"
    aria-label="Navigation principale"
    class="fixed inset-y-0 left-0 z-20 w-72 h-screen bg-white border-r md:relative md:block"
  >
    <div class="h-full overflow-y-auto p-4">
      <h2 class="mb-4 text-lg font-semibold text-accent-700">
        <a href="/" class="transition-colors hover:text-accent-500">{SITE_TITLE}</a>
      </h2>
      {navigation.map((section) => (
        <div class="mb-4">
          <h2 class="mb-2 px-2 text-sm font-semibold text-neutral-700 uppercase">
            {section.shortTitle ?? section.chapitre}
          </h2>
          <nav class="flex flex-col">
            {section.sousChapitre.map((sub) => (
              <SidebarLink
                href={sub.href}
                class="px-2 py-1 text-neutral-700 transition-colors hover:bg-accent-50 hover:text-accent-700"
              >
                {sub.label}
              </SidebarLink>
            ))}
          </nav>
        </div>
      ))}
    </div>
  </aside>
</div>
